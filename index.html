
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAVRP Real Estate</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Utils ---
        const currency = (n) =>
          typeof n === "number"
            ? n.toLocaleString(undefined, { style: "currency", currency: "USD" })
            : n || "-";

        const uid = () => Math.random().toString(36).slice(2);

        // --- Seed Data (feel free to replace with your own) ---
        const SEED = [
          {
            id: uid(),
            type: "House", // House | Business
            name: "8043 Digital Den",
            address: "8043 Joshua Rd",
            postalCode: "12345",
            status: "Available", // Available | Taken
            price: 3000, // Either daily rent or total price
            paymentType: "Rent", // Rent | Sale
            mortgageRemaining: 0,
            shell: "mlo",
            storage: 2,
            owner: "",
            notes: "Cozy starter spot near Legion.",
            images: [],
            tbx: "No", // TBX: Yes or No
            tbxCost: 0, // TBX cost per month in USD
          },
          {
            id: uid(),
            type: "House",
            name: "3043 Trailer B",
            address: "3043 Route 68",
            postalCode: "67890",
            status: "Available",
            price: 90000,
            paymentType: "Sale",
            mortgageRemaining: 0,
            shell: "shell_medium2",
            storage: 1,
            owner: "",
            notes: "Great value.",
            images: [],
            tbx: "No", // TBX: Yes or No
            tbxCost: 0, // TBX cost per month in USD
          },
          {
            id: uid(),
            type: "Business",
            name: "SAFR Mansion",
            address: "Mirror Park Dr 133",
            postalCode: "90210",
            status: "Taken",
            price: 2650, // Rental price for business
            paymentType: "Rent", // Business always rental
            mortgageRemaining: 1825198,
            shell: "vinewood_k4mb1",
            storage: 5,
            owner: "John Doe",
            notes: "Company HQ.",
            images: [],
            tbx: "No", // TBX: Yes or No
            tbxCost: 0, // TBX cost per month in USD
          },
          {
            id: uid(),
            type: "Business",
            name: "Cayo Circle K",
            address: "Cayo Kiosk",
            postalCode: "54321",
            status: "Available", // Business properties are available for rent
            price: 3800,
            paymentType: "Rent", // Business always rental
            mortgageRemaining: 0,
            shell: "shell_store3",
            storage: 3,
            owner: "",
            notes: "Island shopfront.",
            images: [],
            tbx: "No", // TBX: Yes or No
            tbxCost: 0, // TBX cost per month in USD
          },
          {
            id: uid(),
            type: "House",
            name: "4016 Route 68 D",
            address: "Route 68",
            postalCode: "11111",
            status: "Available", // Rental properties can be available or taken
            price: 800, // Rental price
            paymentType: "Rent", // Rental properties should be Rent
            mortgageRemaining: 0,
            shell: "k4_trailer",
            storage: 0,
            owner: "",
            notes: "Investment property.",
            images: [],
            tbx: "No", // TBX: Yes or No
            tbxCost: 0, // TBX cost per month in USD
          },
        ];

        // --- LocalStorage helpers ---
        const LS_KEY = "SAVRP_real_estate_demo_v1";
        const loadStore = () => {
          try {
            const raw = localStorage.getItem(LS_KEY);
            if (!raw) return null;
            return JSON.parse(raw);
          } catch {
            return null;
          }
        };
        const saveStore = (data) => localStorage.setItem(LS_KEY, JSON.stringify(data));

        function App() {
          const [properties, setProperties] = useState(() => loadStore()?.properties || SEED);
          const [filterType, setFilterType] = useState("All");
          const [filterStatus, setFilterStatus] = useState("All");
          const [query, setQuery] = useState("");
          const [sortBy, setSortBy] = useState("price_desc");
          const [adminAuthed, setAdminAuthed] = useState(false);
          const [showAdmin, setShowAdmin] = useState(false);
          const [editorOpen, setEditorOpen] = useState(false);
          const [editing, setEditing] = useState(null); // id | null

          useEffect(() => {
            saveStore({ properties });
          }, [properties]);

          const filtered = useMemo(() => {
            let list = [...properties];

            if (filterType !== "All") list = list.filter((p) => p.type === filterType);
            if (filterStatus !== "All") {
              if (filterStatus === "Rental") {
                // Show properties that are for rent (paymentType === "Rent")
                list = list.filter((p) => p.paymentType === "Rent");
              } else {
                list = list.filter((p) => p.status === filterStatus);
              }
            }

            if (query.trim()) {
              const q = query.toLowerCase();
              list = list.filter(
                (p) =>
                  p.name.toLowerCase().includes(q) ||
                  p.address.toLowerCase().includes(q) ||
                  (p.notes || "").toLowerCase().includes(q)
              );
            }

            if (sortBy === "price_asc") list.sort((a, b) => (a.price || 0) - (b.price || 0));
            if (sortBy === "price_desc") list.sort((a, b) => (b.price || 0) - (a.price || 0));
            if (sortBy === "name_asc") list.sort((a, b) => a.name.localeCompare(b.name));

            return list;
          }, [properties, filterType, filterStatus, query, sortBy]);

          function openEditor(item) {
            setEditing(item || {
              id: uid(),
              type: "House",
              name: "",
              address: "",
              postalCode: "",
              status: "Available",
              price: 0,
              paymentType: "Sale",
              mortgageRemaining: 0,
              shell: "",
              storage: 0,
              owner: "",
              notes: "",
              images: [],
              tbx: "No", // TBX: Yes or No
              tbxCost: 0, // TBX cost per month in USD
            });
            setEditorOpen(true);
          }

          function saveProperty(prop) {
            setProperties((prev) => {
              const exists = prev.some((p) => p.id === prop.id);
              return exists ? prev.map((p) => (p.id === prop.id ? prop : p)) : [prop, ...prev];
            });
            setEditorOpen(false);
            setEditing(null);
          }

          function removeProperty(id) {
            if (!confirm("Delete this property?")) return;
            setProperties((prev) => prev.filter((p) => p.id !== id));
          }

          return (
            <div className="min-h-screen bg-slate-50">
              {/* Top Bar */}
              <header className="sticky top-0 z-20 bg-white/90 backdrop-blur border-b border-slate-200">
                <div className="mx-auto max-w-7xl px-4 py-3 flex items-center gap-3">
                  <div className="h-9 w-9 rounded-xl bg-slate-900 text-white grid place-items-center font-bold">RP</div>
                  <div className="flex-1">
                    <h1 className="text-lg font-semibold">SAVRP Real Estate</h1>
                    <p className="text-xs text-slate-500">Browse listings, filter by availability, and manage properties.</p>
                  </div>
                  <button
                    onClick={() => setShowAdmin(true)}
                    className="px-3 py-1.5 rounded-lg border border-slate-300 text-sm hover:bg-slate-100"
                  >
                    Admin
                  </button>
                </div>
              </header>

              {/* Controls */}
              <div className="mx-auto max-w-7xl px-4 py-4">
                <div className="grid md:grid-cols-5 gap-3">
                  <input
                    value={query}
                    onChange={(e) => setQuery(e.target.value)}
                    placeholder="Search name, address, notes..."
                    className="md:col-span-2 w-full px-3 py-2 rounded-xl border border-slate-300 focus:outline-none focus:ring-2 focus:ring-slate-400"
                  />

                  <select
                    value={filterType}
                    onChange={(e) => setFilterType(e.target.value)}
                    className="px-3 py-2 rounded-xl border border-slate-300"
                  >
                    <option>All</option>
                    <option>House</option>
                    <option>Business</option>
                  </select>

                  <select
                    value={filterStatus}
                    onChange={(e) => setFilterStatus(e.target.value)}
                    className="px-3 py-2 rounded-xl border border-slate-300"
                  >
                    <option>All</option>
                    <option>Available</option>
                    <option>Taken</option>
                    <option>Rental</option>
                  </select>

                  <select
                    value={sortBy}
                    onChange={(e) => setSortBy(e.target.value)}
                    className="px-3 py-2 rounded-xl border border-slate-300"
                  >
                    <option value="price_desc">Sort: Price High → Low</option>
                    <option value="price_asc">Sort: Price Low → High</option>
                    <option value="name_asc">Sort: Name A → Z</option>
                  </select>
                </div>

                <div className="mt-3 text-sm text-slate-600">{filtered.length} result{filtered.length !== 1 && "s"}</div>
              </div>

              {/* Grid */}
              <main className="mx-auto max-w-7xl px-4 pb-16 grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
                {filtered.map((p) => (
                  <PropertyCard
                    key={p.id}
                    p={p}
                    admin={adminAuthed}
                    onEdit={() => openEditor(p)}
                    onDelete={() => removeProperty(p.id)}
                    onUpdate={(np) => saveProperty(np)}
                  />)
                )}

                {filtered.length === 0 && (
                  <div className="col-span-full rounded-xl border border-dashed p-10 text-center text-slate-500">
                    No properties match your filters.
                  </div>
                )}
              </main>

              {/* Admin Dialog */}
              {showAdmin && (
                <AdminDialog
                  onClose={() => setShowAdmin(false)}
                  authed={adminAuthed}
                  setAuthed={setAdminAuthed}
                  onAdd={() => openEditor(null)}
                />)
              }

              {/* Editor Dialog */}
              {editorOpen && (
                <EditorDialog
                  value={editing}
                  onClose={() => setEditorOpen(false)}
                  onSave={saveProperty}
                />)
              }
            </div>
          );
        }

        function Badge({ children, color = "slate" }) {
          const map = {
            slate: "bg-slate-100 text-slate-700 border-slate-200",
            green: "bg-green-100 text-green-700 border-green-200",
            red: "bg-rose-100 text-rose-700 border-rose-200",
            amber: "bg-amber-100 text-amber-800 border-amber-200",
            blue: "bg-blue-100 text-blue-700 border-blue-200",
          };
          return (
            <span className={`px-2 py-0.5 rounded-full text-xs border ${map[color]}`}>{children}</span>
          );
        }

        function PropertyCard({ p, admin, onEdit, onDelete, onUpdate }) {
          const inputRef = useRef(null);

          function handleFile(e) {
            const files = Array.from(e.target.files || []);
            if (!files.length) return;
            const urls = files.map((f) => URL.createObjectURL(f));
            onUpdate({ ...p, images: [...(p.images || []), ...urls] });
          }

          return (
            <div className="rounded-2xl border border-slate-200 bg-white overflow-hidden shadow-sm">
              <div className="aspect-[16/9] bg-slate-100 relative">
                {p.images?.length ? (
                  <img src={p.images[0]} alt={p.name} className="absolute inset-0 h-full w-full object-cover" />
                ) : (
                  <div className="absolute inset-0 grid place-items-center text-slate-400 text-sm">No photo</div>
                )}
                {admin && (
                  <div className="absolute top-2 right-2 flex gap-2">
                    <button
                      onClick={() => inputRef.current?.click()}
                      className="px-2 py-1 rounded-lg text-xs bg-white/90 border border-slate-300 hover:bg-white"
                    >
                      Upload
                    </button>
                    <input
                      ref={inputRef}
                      type="file"
                      accept="image/*"
                      multiple
                      hidden
                      onChange={handleFile}
                    />
                  </div>
                )}
              </div>
              <div className="p-4 space-y-3">
                <div className="flex items-start justify-between gap-2">
                  <div>
                    <h3 className="font-semibold leading-tight">{p.name}</h3>
                    <div className="text-sm text-slate-500">{p.address || "—"}</div>
                  </div>
                  <div className="text-right">
                    <div className="text-lg font-bold">{currency(p.price)}</div>
                    <div className="text-xs text-slate-500">{p.paymentType}</div>
                  </div>
                </div>

                <div className="flex flex-wrap gap-2">
                  <Badge color={p.type === "Business" ? "blue" : "slate"}>{p.type}</Badge>
                  {p.status === "Available" && (
                    <Badge color={p.paymentType === "Rent" ? "amber" : "green"}>
                      {p.paymentType === "Rent" ? "For Rent" : "Available"}
                    </Badge>
                  )}
                  {p.status === "Taken" && <Badge color="red">Taken</Badge>}
                  {p.shell && <Badge>Shell: {p.shell}</Badge>}
                  {(p.mortgageRemaining || 0) > 0 && p.paymentType === "Sale" && (
                    <Badge color="amber">Mortgage: {currency(p.mortgageRemaining)}</Badge>
                  )}
                  <Badge>Storage: {p.storage > 0 ? p.storage : "N/A"}</Badge>
                  
                  {/* TBX Badge */}
                  {p.tbx === "Yes" && p.tbxCost > 0 && (
                    <Badge color="blue">TBX: {currency(p.tbxCost)}/mo</Badge>
                  )}
                </div>

                {p.postalCode && (
                  <div className="text-sm text-slate-600">
                    Postal Code: {p.postalCode}
                  </div>
                )}

                {p.status === "Taken" && p.owner && (
                  <div className="text-sm text-slate-600">
                    Owner: {p.owner}
                  </div>
                )}

                {p.notes && <p className="text-sm text-slate-600">{p.notes}</p>}

                {admin && (
                  <div className="pt-2 flex gap-2">
                    <button
                      onClick={onEdit}
                      className="px-3 py-1.5 rounded-lg border border-slate-300 text-sm hover:bg-slate-50"
                    >
                      Edit
                    </button>
                    <button
                      onClick={onDelete}
                      className="px-3 py-1.5 rounded-lg border border-rose-300 text-sm hover:bg-rose-50 text-rose-700"
                    >
                      Delete
                    </button>
                  </div>
                )}
              </div>
            </div>
          );
        }

        function AdminDialog({ onClose, authed, setAuthed, onAdd }) {
          const [u, setU] = useState("");
          const [p, setP] = useState("");
          const [show, setShow] = useState(false);

          return (
            <div className="fixed inset-0 bg-black/40 grid place-items-center p-4">
              <div className="w-full max-w-lg rounded-2xl bg-white shadow-xl border border-slate-200">
                <div className="p-4 border-b flex items-center justify-between">
                  <h2 className="font-semibold">Admin</h2>
                  <button onClick={onClose} className="px-2 py-1 rounded-lg text-sm hover:bg-slate-100">Close</button>
                </div>

                {!authed ? (
                  <div className="p-4 space-y-3">
                    <p className="text-sm text-slate-600">Demo credentials: <b>admin</b> / <b>admin123</b></p>
                    <input
                      value={u}
                      onChange={(e) => setU(e.target.value)}
                      placeholder="Username"
                      className="w-full px-3 py-2 rounded-xl border border-slate-300"
                    />
                    <div className="flex gap-2">
                      <input
                        type={show ? "text" : "password"}
                        value={p}
                        onChange={(e) => setP(e.target.value)}
                        placeholder="Password"
                        className="w-full px-3 py-2 rounded-xl border border-slate-300"
                      />
                      <button onClick={() => setShow((s) => !s)} className="px-3 rounded-xl border">{show ? "Hide" : "Show"}</button>
                    </div>
                    <button
                      onClick={() => {
                        if (u === "admin" && p === "admin123") setAuthed(true);
                        else alert("Invalid credentials for demo");
                      }}
                      className="w-full px-3 py-2 rounded-xl bg-slate-900 text-white"
                    >
                      Sign In
                    </button>
                  </div>
                ) : (
                  <div className="p-4 space-y-3">
                    <div className="rounded-xl bg-slate-50 border p-3 text-sm text-slate-600">
                      You are signed in. You can add, edit, delete listings and upload images. All data saves to your browser.
                    </div>
                    <div className="flex gap-2">
                      <button onClick={onAdd} className="px-3 py-2 rounded-xl border border-slate-300 hover:bg-slate-50">Add Listing</button>
                      <button onClick={() => setAuthed(false)} className="px-3 py-2 rounded-xl border border-slate-300 hover:bg-slate-50">Sign Out</button>
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        }

        function Field({ label, children }) {
          return (
            <label className="grid gap-1 text-sm">
              <span className="text-slate-600">{label}</span>
              {children}
            </label>
          );
        }

        function EditorDialog({ value, onClose, onSave }) {
          const [draft, setDraft] = useState(value);

          function update(key, val) {
            setDraft((d) => ({ ...d, [key]: val }));
            
            // Business properties are always for Rent
            if (key === "type" && val === "Business") {
              setDraft((d) => ({
                ...d,
                type: "Business",
                paymentType: "Rent",
                mortgageRemaining: 0 // Business rentals have no mortgage
              }));
            }
            
            // When switching to Rent payment type, clear mortgage
            if (key === "paymentType" && val === "Rent") {
              setDraft((d) => ({ ...d, mortgageRemaining: 0 }));
            }
          }

          return (
            <div className="fixed inset-0 bg-black/40 grid place-items-center p-4">
              <div className="w-full max-w-2xl rounded-2xl bg-white shadow-xl border border-slate-200">
                <div className="p-4 border-b flex items-center justify-between">
                  <h2 className="font-semibold">{value?.name ? "Edit Listing" : "New Listing"}</h2>
                  <button onClick={onClose} className="px-2 py-1 rounded-lg text-sm hover:bg-slate-100">Close</button>
                </div>

                <div className="p-4 grid sm:grid-cols-2 gap-3">
                  <Field label="Type">
                    <select
                      value={draft.type}
                      onChange={(e) => update("type", e.target.value)}
                      className="px-3 py-2 rounded-xl border border-slate-300"
                    >
                      <option>House</option>
                      <option>Business</option>
                    </select>
                  </Field>
                  <Field label="Status">
                    <select
                      value={draft.status}
                      onChange={(e) => update("status", e.target.value)}
                      className="px-3 py-2 rounded-xl border border-slate-300"
                    >
                      <option>Available</option>
                      <option>Taken</option>
                    </select>
                  </Field>
                  <Field label="Name">
                    <input
                      value={draft.name}
                      onChange={(e) => update("name", e.target.value)}
                      className="px-3 py-2 rounded-xl border border-slate-300"
                    />
                  </Field>
                  <Field label="Address">
                    <input
                      value={draft.address}
                      onChange={(e) => update("address", e.target.value)}
                      className="px-3 py-2 rounded-xl border border-slate-300"
                    />
                  </Field>
                  <Field label="Postal Code">
                    <input
                      value={draft.postalCode}
                      onChange={(e) => update("postalCode", e.target.value)}
                      className="px-3 py-2 rounded-xl border border-slate-300"
                    />
                  </Field>
                  <Field label="Price (number)">
                    <input
                      type="number"
                      value={draft.price}
                      onChange={(e) => update("price", Number(e.target.value))}
                      className="px-3 py-2 rounded-xl border border-slate-300"
                    />
                  </Field>
                  <Field label="Payment Type">
                    <select
                      value={draft.paymentType}
                      onChange={(e) => update("paymentType", e.target.value)}
                      className="px-3 py-2 rounded-xl border border-slate-300"
                      disabled={draft.type === "Business"}
                    >
                      <option>Sale</option>
                      <option>Rent</option>
                    </select>
                  </Field>
                  {draft.paymentType === "Sale" && (
                    <Field label="Mortgage Remaining (number)">
                      <input
                        type="number"
                        value={draft.mortgageRemaining}
                        onChange={(e) => update("mortgageRemaining", Number(e.target.value))}
                        className="px-3 py-2 rounded-xl border border-slate-300"
                      />
                    </Field>
                  )}
                  <Field label="Shell / MLO">
                    <input
                      value={draft.shell}
                      onChange={(e) => update("shell", e.target.value)}
                      className="px-3 py-2 rounded-xl border border-slate-300"
                    />
                  </Field>
                  <Field label="Storage (number)">
                    <input
                      type="number"
                      value={draft.storage}
                      onChange={(e) => update("storage", Number(e.target.value))}
                      className="px-3 py-2 rounded-xl border border-slate-300"
                    />
                  </Field>
                  {draft.status === "Taken" && (
                    <Field label="Owner Name">
                      <input
                        value={draft.owner}
                        onChange={(e) => update("owner", e.target.value)}
                        className="px-3 py-2 rounded-xl border border-slate-300"
                      />
                    </Field>
                  )}
                  <div className="sm:col-span-2">
                    <Field label="Notes">
                      <textarea
                        rows={3}
                        value={draft.notes}
                        onChange={(e) => update("notes", e.target.value)}
                        className="w-full px-3 py-2 rounded-xl border border-slate-300"
                      />
                    </Field>
                  </div>
                  
                  {/* TBX Fields */}
                  <Field label="TBX Included">
                    <select
                      value={draft.tbx}
                      onChange={(e) => update("tbx", e.target.value)}
                      className="px-3 py-2 rounded-xl border border-slate-300"
                    >
                      <option>No</option>
                      <option>Yes</option>
                    </select>
                  </Field>
                  
                  {draft.tbx === "Yes" && (
                    <Field label="TBX Cost per Month (USD)">
                      <input
                        type="number"
                        value={draft.tbxCost}
                        onChange={(e) => update("tbxCost", Number(e.target.value))}
                        className="px-3 py-2 rounded-xl border border-slate-300"
                        placeholder="0.00"
                        min="0"
                        step="0.01"
                      />
                    </Field>
                  )}
                </div>

                <div className="p-4 border-t flex items-center justify-end gap-2">
                  <button onClick={onClose} className="px-3 py-2 rounded-xl border border-slate-300">Cancel</button>
                  <button onClick={() => onSave(draft)} className="px-3 py-2 rounded-xl bg-slate-900 text-white">Save Listing</button>
                </div>
              </div>
            </div>
          );
        }

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
